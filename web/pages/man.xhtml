<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">
    <h:head>
        <title> Информационный центр </title>
        <h:outputStylesheet library="css" name="style_main.css"/>
    </h:head>

    <h:body>
        <ui:composition template="/templates/perfect_template.xhtml">

            <ui:define name="man_count">
                <h:outputText value="#{msg.man_count} #{manListController.pager.totalManCount}" id="manCount"></h:outputText>
            </ui:define>

            <ui:define name="content" >
                
                <p:growl life="3000" id="growlMessage" globalOnly=""

                <h:form id="manForm">

                    <h:panelGroup id="admin_tools" rendered="#{request.isUserInRole('ADMIN')}"> <!-- панель администратора (редактирование информации о сотрудниках и добавление новых сотрудников) -->

                        <h:commandLink rendered="#{!manListController.editModeView}">  <!-- ссылка Добавить сотрудника -->
                            <h:graphicImage library="images" name="add.png" height="20" width="20"/>
                            <h:outputText value="#{msg.add_man}"></h:outputText>
                            <f:ajax onevent="showProgress" execute="@form" render="@form"/>
                        </h:commandLink> 

                        <h:commandLink action="#{manListController.showEdit()}" rendered="#{!manListController.editModeView}"> <!-- ссылка Редактировать -->
                            <h:graphicImage library="images" name="edit.jpg" height="20" width="20"/>
                            <h:outputText value="#{msg.edit}"></h:outputText>
                            <f:ajax onevent="showProgress" execute="@form" render="@form :manCount"/>
                        </h:commandLink>

                        <h:commandButton action="#{manListController.updateMan()}" rendered="#{manListController.editModeView}" 
                                         value="#{msg.save}"> <!-- кнопка Сохранить -->
                            <f:ajax onevent="showProgress" execute="@form" render="@form :manCount"/>
                        </h:commandButton> 

                        <h:commandButton immediate="true" action="#{manListController.cancelEditMode()}" rendered="#{manListController.editModeView}" 
                                         value="#{msg.cancel}"> <!-- кнопка Отмена -->
                            <f:ajax onevent="showProgress" execute="@form" render="@form"/>
                        </h:commandButton> 
                    </h:panelGroup>

                    <p:dataTable lazy="true" var="m" value="#{manListController.manListModel}"  id="manList" rowIndexVar="rowIndex" styleClass="man_list" paginator="true"
                                 rows="5" rowsPerPageTemplate="5,10,15" paginatorTemplate="{RowsPerPageDropdown} {PageLinks}" paginatorAlwaysVisible="false" emptyMessage="">

                        <p:column> <!-- колонка с фотографией сотрудника -->
                            <h:graphicImage value="../resources/#{m.photo}" height="120" width="90" />
                        </p:column>

                        <p:column> <!-- колонка с основными данными сотрудника -->
                            <p>
                                <strong>ФАМИЛИЯ:</strong> 
                                <h:outputText value="#{m.surname}" rendered="#{!manListController.editModeView}"/>
                                <h:inputText value="#{m.surname}" rendered="#{manListController.editModeView and m.edit}" styleClass="name_edit"/>
                            </p>

                            <p>
                                <strong>ИМЯ:</strong> 
                                <h:outputText value="#{m.name}" rendered="#{!manListController.editModeView}"/>
                                <h:inputText value="#{m.name}" rendered="#{manListController.editModeView and m.edit}" styleClass="name_edit"/>
                            </p>

                            <p>
                                <strong>ОТЧЕСТВО:</strong> 
                                <h:outputText value="#{m.otchestvo}" rendered="#{!manListController.editModeView}"/>
                                <h:inputText value="#{m.otchestvo}" rendered="#{manListController.editModeView and m.edit}" styleClass="name_edit"/>
                            </p> <!-- чтобы отображалось поле в режиме редактирования, д.б. поставлен флажок напротив нужного сотрудника (m.edit) -->

                            <h:panelGroup rendered="#{manListController.editModeView and m.edit}"> <!-- данное поле будет появляться только при редактировании -->
                                <p>
                                    <strong>ДАТА РОЖДЕНИЯ:</strong> 
                                    <h:inputText value="#{m.birthDate}" styleClass="name_edit"/>
                                </p> 
                            </h:panelGroup>

                            <h:panelGroup rendered="#{!manListController.editModeView}"> <!-- данное поле будет появляться только при просмотре -->
                                <p>                                                  <!-- и зависеть от введенной даты рождения -->
                                    <strong>ВОЗРАСТ:</strong> 
                                    <h:outputText value="#{m.birthDate}"/>
                                </p>
                            </h:panelGroup>

                            <p>
                                <strong>ДОЛЖНОСТЬ:</strong>  
                                <h:outputText value="#{m.sprDoljnostByDoljnostId.doljnost}" rendered="#{!manListController.editModeView}"/>

                                <h:selectOneMenu rendered="#{manListController.editModeView and m.edit}" value="#{m.sprDoljnostByDoljnostId}" converter="#{doljnostController}">
                                    <f:selectItems value="#{doljnostController.selectItems}"/>
                                </h:selectOneMenu>  
                            </p>

                            <p>
                                <strong>ФИРМА:</strong>  
                                <h:outputText value="#{m.sprFirmByFirmId.firm}" rendered="#{!manListController.editModeView}"/>

                                <h:selectOneMenu rendered="#{manListController.editModeView and m.edit}" converter="#{firmController}" value="#{m.sprFirmByFirmId}"> <!--отображается текущее значение этого поля объекта Man-->
                                    <f:selectItems value="#{firmController.selectItems}"/>
                                </h:selectOneMenu>  
                            </p>

                            <h:panelGroup rendered="#{!manListController.editModeView and (m.sprFirmByFirmId.firm != m.sprFirmByFirm2Id.firm)}">
                                <p>
                                    <strong>ДОЛЖНОСТЬ2:</strong>  
                                    <h:outputText value="#{m.sprDoljnostByDoljnost2Id.doljnost}" rendered="#{!manListController.editModeView}"/>
                                </p>
                            </h:panelGroup>
                            <h:panelGroup rendered="#{manListController.editModeView}">
                                <p>
                                    <strong>ДОЛЖНОСТЬ2:</strong>
                                    <h:selectOneMenu rendered="#{manListController.editModeView and m.edit}" value="#{m.sprDoljnostByDoljnost2Id}" converter="#{doljnostController}">
                                        <f:selectItems value="#{doljnostController.selectItems}"/>
                                    </h:selectOneMenu>  
                                </p>
                            </h:panelGroup>

                            <h:panelGroup rendered="#{!manListController.editModeView and (m.sprFirmByFirmId.firm != m.sprFirmByFirm2Id.firm)}">
                                <p>
                                    <strong>ФИРМА2:</strong>  
                                    <h:outputText value="#{m.sprFirmByFirm2Id.firm}" rendered="#{!manListController.editModeView}"/>
                                </p>
                            </h:panelGroup>
                            <h:panelGroup rendered="#{manListController.editModeView}">
                                <p>
                                    <strong>ФИРМА2:</strong>
                                    <h:selectOneMenu rendered="#{manListController.editModeView and m.edit}" value="#{m.sprFirmByFirm2Id}" converter="#{firmController}">
                                        <f:selectItems value="#{firmController.selectItems}"/>
                                    </h:selectOneMenu>  
                                </p>
                            </h:panelGroup>

                        </p:column>


                        <!-- обложки документов (начало) -->
                        <p:column>
                            <p><h:outputLink value="#{request.contextPath}/PdfContent?manId=#{m.id}&amp;table=entity.Passport" target="blank"> <!-- blank - открывать в новой вкладке -->
                                    <h:graphicImage value="../resources/images/oblojki_dok/oblojka_passport.jpg" height="60" width="45" alt="Паспорт"/>
                                </h:outputLink>

                                <h:outputLink value="#{request.contextPath}/PdfContent?manId=#{m.id}&amp;table=entity.DiplomVuz" target="blank"> <!-- blank - открывать в новой вкладке -->
                                    <h:graphicImage value="../resources/images/oblojki_dok/oblojka_vuz.jpg" height="60" width="45" alt="Диплом ВУЗ"/>
                                </h:outputLink>

                                <h:outputLink value="#{request.contextPath}/PdfContent?manId=#{m.id}&amp;table=entity.DiplomSsuz" target="blank"> <!-- blank - открывать в новой вкладке -->
                                    <h:graphicImage value="../resources/images/oblojki_dok/oblojka_vuz_per.jpg" height="60" width="45" alt="Диплом ССУЗ"/>
                                </h:outputLink> </p>

                            <p><h:outputLink value="#{request.contextPath}/PdfContent?manId=#{m.id}&amp;table=entity.TrudBook" target="blank"> <!-- blank - открывать в новой вкладке -->
                                    <h:graphicImage value="../resources/images/oblojki_dok/oblojka_trud_book.jpg" height="60" width="45" alt="Трудовая книжка"/>
                                </h:outputLink>

                                <h:outputLink value="#{request.contextPath}/PdfContent?manId=#{m.id}&amp;table=entity.SvidPovqual" target="blank"> <!-- blank - открывать в новой вкладке -->
                                    <h:graphicImage value="../resources/images/oblojki_dok/oblojka_svid_pov_qual.jpg" height="60" width="45" alt="ПОВЫШ КВ"/>
                                </h:outputLink>

                                <h:outputLink value="#{request.contextPath}/PdfContent?manId=#{m.id}&amp;table=entity.UdPoot" target="blank"> <!-- blank - открывать в новой вкладке -->
                                    <h:graphicImage value="../resources/images/oblojki_dok/oblojka_ud_po_ot.jpg" height="60" width="45" alt="ОТ"/>
                                </h:outputLink></p>
                        </p:column>
                        <!-- обложки документов (окончание) -->

                        <p:column rendered="#{request.isUserInRole('ADMIN')}">
                            <h:selectBooleanCheckbox value="#{m.edit}" rendered="#{!manListController.editModeView}">
                                <f:ajax event="change"/>
                            </h:selectBooleanCheckbox>
                        </p:column> 

                    </p:dataTable>

                </h:form>
            </ui:define>
        </ui:composition>
    </h:body>
</html>

